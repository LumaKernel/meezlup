# Task 000: テスタブル設計移行タスクサマリー

## 概要
vi.mockを使わないテスタブルな設計への移行を実現するための、段階的なタスクの概要と進捗管理。

## 移行の目的
1. **モックの削減**: vi.mockの使用を90%以上削減
2. **テストの安定性**: act warningの排除、リファクタリング耐性の向上
3. **コードの品質**: 責務の明確な分離、再利用可能なコンポーネント
4. **開発効率**: テスト作成時間の50%削減

## タスク一覧と優先順位

### Phase 1: 基盤整備（推定2日）
- [x] Task 001: 基盤Provider/Contextの作成（1日）✅ 2025-07-23完了
  - NavigationProvider、ActionsProviderの実装
  - 依存性注入の基盤作り
  
- [ ] Task 002: テストユーティリティとファクトリの整備（1日）
  - テストデータファクトリ
  - カスタムレンダラー
  - テストヘルパー関数

### Phase 2: 高優先度コンポーネント（推定5.5日）
- [ ] Task 003: EventCreateFormのリファクタリング（2日）
  - Server Actionsとナビゲーションの抽象化
  - Presentational/Container分離
  
- [ ] Task 004: EventParticipateのリファクタリング（2日）
  - 複雑な状態管理の整理
  - 自動保存機能の改善
  
- [ ] Task 005: 認証関連コンポーネントのリファクタリング（1.5日）
  - AuthProvider作成
  - AuthGuard、LoginButton、UserProfileの改善

### Phase 3: 中優先度コンポーネント（推定1.5日）
- [ ] Task 006: LanguageSwitcherのリファクタリング（0.5日）
  - ナビゲーション抽象化の適用
  
- [ ] Task 007: ScheduleInputLayoutのリファクタリング（1日）
  - 状態管理の抽出
  - サブコンポーネントへの分割

### Phase 4: 統合とクリーンアップ（推定1日）
- [ ] Task 008: ドキュメント作成とクリーンアップ（1日）
  - テスト戦略ドキュメント
  - ベストプラクティスガイド
  - 古いモックコードの削除

## 総推定作業量
約10日

## 実装順序と依存関係
```
Task 001 (Provider/Context)
    ↓
Task 002 (テストユーティリティ)
    ↓
    ├─→ Task 003 (EventCreateForm)
    ├─→ Task 004 (EventParticipate)
    └─→ Task 005 (認証コンポーネント)
         ↓
         ├─→ Task 006 (LanguageSwitcher)
         └─→ Task 007 (ScheduleInputLayout)
              ↓
              Task 008 (ドキュメント)
```

## 進捗トラッキング
- [ ] Phase 1 完了（50% - Task 001完了、Task 002未着手）
- [ ] Phase 2 完了
- [ ] Phase 3 完了
- [ ] Phase 4 完了

### 2025-07-23 進捗更新
- Task 001完了: NavigationProvider、ActionsProvider、ServerActionsProviderを実装
- renderWithProvidersテストヘルパーを作成
- 現在のテスト成功率: 33/46 (71.7%)

## 成功指標
1. **定量的指標**
   - vi.mock使用箇所: 現在50箇所 → 目標5箇所以下
   - テスト実行時間: 現在15秒 → 目標10秒以下
   - テスト成功率: 現在68% → 目標95%以上

2. **定性的指標**
   - 新規コンポーネント作成時のテスト作成が容易
   - リファクタリング時にテストが壊れにくい
   - コンポーネントの責務が明確

## リスクと対策
1. **既存機能への影響**
   - 段階的移行で影響を最小化
   - 各フェーズごとにE2Eテストで確認

2. **学習コスト**
   - ペアプログラミングで知識共有
   - サンプルコードとドキュメントの充実

3. **スケジュール遅延**
   - 週次レビューで進捗確認
   - 必要に応じてスコープ調整

## 次のアクション
1. Task 001の実装開始
2. 週次進捗レビューの設定
3. チームへの共有とフィードバック収集

## 現在の課題と対策
1. **server-onlyモジュールエラー**
   - 多くのテストでserver-onlyインポートエラーが発生
   - Task 002でモックセットアップを整備予定

2. **act warning**
   - EventParticipateなどで発生
   - 適切なwaitForユーティリティが必要

3. **vi.mock依存**
   - まだ多くのテストがvi.mockに依存
   - 段階的な移行が必要

---
作成日: 2025-01-23
最終更新: 2025-07-23